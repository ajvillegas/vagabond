(function($){$(document).ready(function(){$('.sortable_repeater_control').each(function(){var defaultValuesArray=$(this).find('.customize-control-sortable-repeater').val().split(',');var numRepeaterItems=defaultValuesArray.length;if(numRepeaterItems>0){$(this).find('.repeater-input').val(defaultValuesArray[0]);if(numRepeaterItems>1){var i;for(i=1;i<numRepeaterItems;++i){ajvcustomizeAppendRow($(this),defaultValuesArray[i]);}}}});$(this).find('.sortable').sortable({update:function(event,ui){ajvcustomizeGetAllInputs($(this).parent());}});$('.sortable').on('click','.customize-control-sortable-repeater-delete',function(event){event.preventDefault();var numItems=$(this).parent().parent().find('.repeater').length;if(numItems>1){$(this).parent().slideUp('fast',function(){var parentContainer=$(this).parent().parent();$(this).remove();ajvcustomizeGetAllInputs(parentContainer);})}else{$(this).parent().find('.repeater-input').val('');ajvcustomizeGetAllInputs($(this).parent().parent().parent());}});$('.customize-control-sortable-repeater-add').click(function(event){event.preventDefault();ajvcustomizeAppendRow($(this).parent());ajvcustomizeGetAllInputs($(this).parent());});$('.sortable').change(function(){ajvcustomizeGetAllInputs($(this).parent());});$('.sortable').on('blur','.repeater-input',function(){var url=$(this);var val=url.val();if(val&&!val.match(/^.+:\/\/.*/)){url.val('http://'+val).trigger('change');}});function ajvcustomizeAppendRow($element,defaultValue=''){var newRow='<div class="repeater" style="display:none"><input type="text" value="'+defaultValue+'" class="repeater-input" placeholder="http://" /><span class="dashicons dashicons-sort"></span><a class="customize-control-sortable-repeater-delete" href="#"><span class="dashicons dashicons-no-alt"></span></a><button class="button vagabond-custom-media-button" type="button">Select Image</div>';$element.find('.sortable').append(newRow);$element.find('.sortable').find('.repeater:last').slideDown('slow',function(){$(this).find('input').focus();});}function ajvcustomizeGetAllInputs($element){var inputValues=$element.find('.repeater-input').map(function(){return $(this).val();}).toArray();$element.find('.customize-control-sortable-repeater').val(inputValues);$element.find('.customize-control-sortable-repeater').trigger('change');}var media_frame;var target_input;$(document.body).on('click.ajvStarterOpenMediaManager','.vagabond-custom-media-button',function(e){e.preventDefault();var target_input=$(this).siblings('.repeater-input');media_frame=wp.media.frames.media_frame=wp.media({className:'media-frame vagabond-media-frame',frame:'select',multiple:false,title:'Choose or Upload Image',library:{type:'image'},button:{text:'Insert Image'}});media_frame.on('select',function(){var media_attachment=media_frame.state().get('selection').first().toJSON();$(target_input).val(media_attachment.url);$(target_input).trigger('change');});media_frame.open();});$('.slider-custom-control').each(function(){var sliderValue=$(this).find('.customize-control-slider-value').val();var newSlider=$(this).find('.slider');var sliderMinValue=parseInt(newSlider.attr('slider-min-value'));var sliderMaxValue=parseInt(newSlider.attr('slider-max-value'));var sliderStepValue=parseInt(newSlider.attr('slider-step-value'));newSlider.slider({value:sliderValue,min:sliderMinValue,max:sliderMaxValue,step:sliderStepValue,change:function(e,ui){$(this).parent().find('.customize-control-slider-value').trigger('change');}});});$('.slider').on('slide',function(event,ui){$(this).parent().find('.customize-control-slider-value').val(ui.value);});$('.slider-reset').on('click',function(){var resetValue=$(this).attr('slider-reset-value');$(this).parent().find('.customize-control-slider-value').val(resetValue);$(this).parent().find('.slider').slider('value',resetValue);});$('.customize-control-slider-value').blur(function(){var resetValue=$(this).val();var slider=$(this).parent().find('.slider');var sliderMinValue=parseInt(slider.attr('slider-min-value'));var sliderMaxValue=parseInt(slider.attr('slider-max-value'));if(resetValue<sliderMinValue){resetValue=sliderMinValue;$(this).val(resetValue);}if(resetValue>sliderMaxValue){resetValue=sliderMaxValue;$(this).val(resetValue);}$(this).parent().find('.slider').slider('value',resetValue);});$('.multi-image-checkbox').on('change',function(){getAllCheckboxes($(this).parent().parent());});function getAllCheckboxes($element){var inputValues=$element.find('.multi-image-checkbox').map(function(){if($(this).is(':checked')){return $(this).val();}}).toArray();$element.find('.customize-control-multi-image-checkbox').val(inputValues).trigger('change');}$('.google-fonts-list').on('change',function(){var elementRegularWeight=$(this).parent().parent().find('.google-fonts-regularweight-style');var elementItalicWeight=$(this).parent().parent().find('.google-fonts-italicweight-style');var elementBoldWeight=$(this).parent().parent().find('.google-fonts-boldweight-style');var selectedFont=$(this).val();var customizerControlName=$(this).attr('control-name');var elementItalicWeightCount=0;var elementBoldWeightCount=0;elementRegularWeight.empty();elementItalicWeight.empty();elementBoldWeight.empty();elementItalicWeight.prop('disabled',false);elementBoldWeight.prop('disabled',false);var bodyfontcontrol=_wpCustomizeSettings.controls[customizerControlName];var indexes=$.map(bodyfontcontrol.ajvcustomizefontslist,function(obj,index){if(obj.family===selectedFont){return index;}});var index=indexes[0];$.each(bodyfontcontrol.ajvcustomizefontslist[index].variants,function(val,text){elementRegularWeight.append($('<option></option>').val(text).html(text));if(text.indexOf("italic")>=0){elementItalicWeight.append($('<option></option>').val(text).html(text));elementItalicWeightCount++;}else{elementBoldWeight.append($('<option></option>').val(text).html(text));elementBoldWeightCount++;}});if(elementItalicWeightCount==0){elementItalicWeight.append($('<option></option>').val('').html('Not Available for this font'));elementItalicWeight.prop('disabled','disabled');}if(elementBoldWeightCount==0){elementBoldWeight.append($('<option></option>').val('').html('Not Available for this font'));elementBoldWeight.prop('disabled','disabled');}$(this).parent().parent().find('.google-fonts-category').val(bodyfontcontrol.ajvcustomizefontslist[index].category);ajvcustomizeGetAllSelects($(this).parent().parent());});$('.google_fonts_select_control select').on('change',function(){ajvcustomizeGetAllSelects($(this).parent().parent());});function ajvcustomizeGetAllSelects($element){var selectedFont={font:$element.find('.google-fonts-list').val(),regularweight:$element.find('.google-fonts-regularweight-style').val(),italicweight:$element.find('.google-fonts-italicweight-style').val(),boldweight:$element.find('.google-fonts-boldweight-style').val(),category:$element.find('.google-fonts-category').val()};$element.find('.customize-control-google-font-selection').val(JSON.stringify(selectedFont)).trigger('change');}$('.customize-control-tinymce-editor').each(function(){var tinyMCEToolbar1String=_wpCustomizeSettings.controls[$(this).attr('id')].ajvcustomizetinymcetoolbar1;var tinyMCEToolbar2String=_wpCustomizeSettings.controls[$(this).attr('id')].ajvcustomizetinymcetoolbar2;wp.editor.initialize($(this).attr('id'),{tinymce:{wpautop:true,toolbar1:tinyMCEToolbar1String,toolbar2:tinyMCEToolbar2String},quicktags:true});});$(document).on('tinymce-editor-init',function(event,editor){editor.on('change',function(e){tinyMCE.triggerSave();$('#'+editor.id).trigger('change');});});$('.alpha-color-control').each(function(){var $control,startingColor,paletteInput,showOpacity,defaultColor,palette,colorPickerOptions,$container,$alphaSlider,alphaVal,sliderOptions;$control=$(this);startingColor=$control.val().replace(/\s+/g,'');paletteInput=$control.attr('data-palette');showOpacity=$control.attr('data-show-opacity');defaultColor=$control.attr('data-default-color');if(paletteInput.indexOf('|')!==-1){palette=paletteInput.split('|');}else if('false'==paletteInput){palette=false;}else{palette=true;}colorPickerOptions={change:function(event,ui){var key,value,alpha,$transparency;key=$control.attr('data-customize-setting-link');value=$control.wpColorPicker('color');if(defaultColor==value){alpha=acp_get_alpha_value_from_color(value);$alphaSlider.find('.ui-slider-handle').text(alpha);}wp.customize(key,function(obj){obj.set(value);});$transparency=$container.find('.transparency');$transparency.css('background-color',ui.color.toString('no-alpha'));},palettes:palette};$control.wpColorPicker(colorPickerOptions);$container=$control.parents('.wp-picker-container:first');$('<div class="alpha-color-picker-container">'+'<div class="min-click-zone click-zone"></div>'+'<div class="max-click-zone click-zone"></div>'+'<div class="alpha-slider"></div>'+'<div class="transparency"></div>'+'</div>').appendTo($container.find('.wp-picker-holder'));$alphaSlider=$container.find('.alpha-slider');alphaVal=acp_get_alpha_value_from_color(startingColor);sliderOptions={create:function(event,ui){var value=$(this).slider('value');$(this).find('.ui-slider-handle').text(value);$(this).siblings('.transparency ').css('background-color',startingColor);},value:alphaVal,range:'max',step:1,min:0,max:100,animate:300};$alphaSlider.slider(sliderOptions);if('true'==showOpacity){$alphaSlider.find('.ui-slider-handle').addClass('show-opacity');}$container.find('.min-click-zone').on('click',function(){acp_update_alpha_value_on_color_control(0,$control,$alphaSlider,true);});$container.find('.max-click-zone').on('click',function(){acp_update_alpha_value_on_color_control(100,$control,$alphaSlider,true);});$container.find('.iris-palette').on('click',function(){var color,alpha;color=$(this).css('background-color');alpha=acp_get_alpha_value_from_color(color);acp_update_alpha_value_on_alpha_slider(alpha,$alphaSlider);if(alpha!=100){color=color.replace(/[^,]+(?=\))/,(alpha/100).toFixed(2));}$control.wpColorPicker('color',color);});$container.find('.button.wp-picker-clear').on('click',function(){var key=$control.attr('data-customize-setting-link');$control.wpColorPicker('color','#ffffff');wp.customize(key,function(obj){obj.set('');});acp_update_alpha_value_on_alpha_slider(100,$alphaSlider);});$container.find('.button.wp-picker-default').on('click',function(){var alpha=acp_get_alpha_value_from_color(defaultColor);acp_update_alpha_value_on_alpha_slider(alpha,$alphaSlider);});$control.on('input',function(){var value=$(this).val();var alpha=acp_get_alpha_value_from_color(value);acp_update_alpha_value_on_alpha_slider(alpha,$alphaSlider);});$alphaSlider.slider().on('slide',function(event,ui){var alpha=parseFloat(ui.value)/100.0;acp_update_alpha_value_on_color_control(alpha,$control,$alphaSlider,false);$(this).find('.ui-slider-handle').text(ui.value);});});Color.prototype.toString=function(flag){if('no-alpha'==flag){return this.toCSS('rgba','1').replace(/\s+/g,'');}if(1>this._alpha){return this.toCSS('rgba',this._alpha).replace(/\s+/g,'');}var hex=parseInt(this._color,10).toString(16);if(this.error){return'';}if(hex.length<6){for(var i=6-hex.length-1;i>=0;i--){hex='0'+hex;}}return'#'+hex;};function acp_get_alpha_value_from_color(value){var alphaVal;value=value.replace(/ /g,'');if(value.match(/rgba\(\d+\,\d+\,\d+\,([^\)]+)\)/)){alphaVal=parseFloat(value.match(/rgba\(\d+\,\d+\,\d+\,([^\)]+)\)/)[1]).toFixed(2)*100;alphaVal=parseInt(alphaVal);}else{alphaVal=100;}return alphaVal;}function acp_update_alpha_value_on_color_control(alpha,$control,$alphaSlider,update_slider){var iris,colorPicker,color;iris=$control.data('a8cIris');colorPicker=$control.data('wpWpColorPicker');iris._color._alpha=alpha;color=iris._color.toString();$control.val(color);colorPicker.toggler.css({'background-color':color});if(update_slider){acp_update_alpha_value_on_alpha_slider(alpha,$alphaSlider);}$control.wpColorPicker('color',color);}function acp_update_alpha_value_on_alpha_slider(alpha,$alphaSlider){$alphaSlider.slider('value',alpha);$alphaSlider.find('.ui-slider-handle').text(alpha.toString());}});})(jQuery);